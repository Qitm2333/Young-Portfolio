# Day 2 - Unity自定义物理重构与游戏循环

**日期**：2026-01-14 ~ 2026-01-15

---

## 概述

完成了自定义物理系统重构，并实现了完整的游戏循环：击球→得分→扭蛋→商店→下一轮。

---

## 完成内容

### 1. 自定义物理系统 (Scripts02)
- `BallPhysics.cs` - 球体组件，包含2D位置/速度
- `PhysicsWorld.cs` - 物理模拟，支持子步进
  - 线性摩擦（恒定减速）
  - 球-球碰撞，弹性响应
  - 墙壁碰撞反弹
  - 球袋检测

### 2. 瞄准预测系统
- `AimPredictor.cs` - 射线-圆形相交检测，精确预测
- 白线：母球到碰撞点的路径
- 黄线：目标球运动方向
- 幽灵球显示碰撞位置

### 3. 游戏状态与流程
- `GameState02.cs` - 阶段/轮次/分数追踪
- `GameManager02.cs` - 游戏流程控制器
  - 轮次完成 → 扭蛋 → 商店 → 下一轮
  - 胜利/失败条件
  - 金币奖励系统（剩余击球次数 + 剩余球数）

### 4. 小丑牌系统
- `JokerSystem.cs` - 10种小丑牌效果
  - 连击加成（纯色/花球）
  - 分数倍率
  - 特殊球加成（7号球、8号球）
  - 首击加成、背水一战等

### 5. 商店与扭蛋UI
- `ShopGachaUI.cs` - 两个界面合一
  - 扭蛋：轮次结束后从3张随机牌中选1张
  - 商店：购买小丑牌（$5），刷新（$2）
  - 稀有度颜色（普通/稀有/史诗）
  - EventSystem处理点击事件

### 6. 游戏UI
- `SimpleGameUI.cs` - HUD显示
- `SimpleUISetup.cs` - 自动创建Canvas
- 显示：分数、目标、击球次数、金币、小丑牌数量

---

## 关键发现

**为什么Unity物理不适用：**
```
Unity阻力: velocity *= (1 - drag * dt)  // 指数衰减
自定义:    velocity -= friction * dt     // 线性衰减
```

**UI点击问题：**
Unity UI需要 `EventSystem` + `StandaloneInputModule` 才能让按钮点击生效。

---

## 当前架构

```
Scripts02/
├── Core/
│   ├── BallPhysics.cs
│   ├── PhysicsWorld.cs
│   └── AimPredictor.cs
├── Game/
│   ├── TestScene.cs
│   ├── SimpleCueController.cs
│   ├── GameState.cs
│   ├── GameManager.cs
│   ├── BallManager02.cs
│   └── JokerSystem.cs
├── Table/
│   └── SimpleTable.cs
└── UI/
    ├── SimpleUISetup.cs
    ├── SimpleGameUI.cs
    └── ShopGachaUI.cs
```

---

## 游戏循环

```
[游戏中]
    ↓ 击球
[等待中] → 球停止
    ↓ 分数 >= 目标?
[轮次完成]
    ↓ 2秒延迟
[扭蛋] → 选择小丑牌
    ↓
[商店] → 购买/刷新/继续
    ↓
[下一轮] → 重置球
```

---

## 下一步

1. ~~15球标准配置~~ ✓
2. ~~游戏流程（轮次、目标分数）~~ ✓
3. ~~小丑牌系统~~ ✓
4. ~~扭蛋 + 商店UI~~ ✓
5. 打磨：动画、音效
6. 特殊球桌（不同布局）
7. 更多小丑牌类型

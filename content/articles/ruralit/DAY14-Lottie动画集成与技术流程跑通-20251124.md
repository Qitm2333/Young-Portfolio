# Ruralilt 项目日报 - DAY14

**日期：** 2025年11月24日
**项目：** Ruralilt - MediaPipe驱动的乡村儿童舞蹈学习与社交平台
**目标：** Lottie动画集成 + 技术流程跑通

---

## 今日工作内容

### 1. 考拉（Kite）Lottie动画集成 ✅

#### 1.1 Figma分层PNG导出

**导出规范：**
- 图层命名：`koala_body`、`koala_head`、`koala_ear_L`、`koala_ear_R`、`koala_eye_L`、`koala_eye_R`、`koala_tail`
- 导出格式：PNG @2x（适配高清屏）
- 背景：透明
- 尺寸：统一画布 400×400px

**分层结构：**
```
考拉Kite
├── koala_body.png      (身体主体)
├── koala_head.png      (头部)
├── koala_ear_L.png     (左耳)
├── koala_ear_R.png     (右耳)
├── koala_eye_L.png     (左眼)
├── koala_eye_R.png     (右眼)
└── koala_tail.png      (尾巴)
```

#### 1.2 AE动画处理细节

**动画参数：**
- 时长：2.5秒循环
- 帧率：30fps
- 总帧数：75帧

**关键帧设计：**

| 部位 | 动作 | 关键帧 | 缓动 |
|------|------|--------|------|
| 眼睛 | 眨眼 | 0f→5f→10f | ease-in-out |
| 头部 | 左右微摇 | 0f→37f→75f | ease-in-out |
| 耳朵 | 轻微抖动 | 随机触发 | linear |
| 尾巴 | 左右摆动 | 0f→25f→50f→75f | ease-in-out |
| 身体 | 呼吸起伏 | 0f→37f→75f | ease-in-out |

**眨眼动画细节：**
```
0f:   眼睛100%打开
3f:   眼睛50%闭合
5f:   眼睛100%闭合
7f:   眼睛50%打开
10f:  眼睛100%打开
... 循环间隔约60帧
```

#### 1.3 Bodymovin导出设置

**导出配置：**
```json
{
  "v": "5.12.1",
  "fr": 30,
  "ip": 0,
  "op": 75,
  "w": 400,
  "h": 400,
  "nm": "koala_idle",
  "ddd": 0,
  "assets": [...],
  "layers": [...]
}
```

**优化选项：**
- ✅ Glyphs（字体转路径）
- ✅ Hidden layers（移除隐藏图层）
- ✅ Compress（压缩JSON）
- 导出文件：`koala_idle.json` (~45KB)

---

### 2. React项目Lottie集成 ✅

#### 2.1 依赖安装

```bash
npm install lottie-react
```

#### 2.2 Lottie组件封装

**文件：** `src/components/LottieAnimation.tsx`

```typescript
import Lottie from 'lottie-react';
import koalaIdle from '../assets/lottie/koala_idle.json';

interface LottieAnimationProps {
  animation: 'koala_idle' | 'koala_celebrate' | 'particles';
  loop?: boolean;
  autoplay?: boolean;
  style?: React.CSSProperties;
}

const animations = {
  koala_idle: koalaIdle,
  // 后续添加更多动画
};

export const LottieAnimation: React.FC<LottieAnimationProps> = ({
  animation,
  loop = true,
  autoplay = true,
  style
}) => {
  return (
    <Lottie
      animationData={animations[animation]}
      loop={loop}
      autoplay={autoplay}
      style={style}
    />
  );
};
```

#### 2.3 集成到收藏页

**修改：** `src/components/CollectionPage.tsx`

```typescript
import { LottieAnimation } from './LottieAnimation';

// 替换静态考拉图片
<LottieAnimation 
  animation="koala_idle"
  style={{ width: 120, height: 120 }}
/>
```

---

### 3. 技术流程验证 ✅

#### 3.1 完整流程测试

```
Figma设计稿
    ↓ 导出分层PNG
After Effects
    ↓ 制作动画 + Bodymovin导出
Lottie JSON
    ↓ 放入 src/assets/lottie/
React组件
    ↓ lottie-react渲染
真机预览 ✅
```

#### 3.2 性能测试

| 指标 | 数值 | 状态 |
|------|------|------|
| JSON文件大小 | 45KB | ✅ 优秀 |
| 首次加载时间 | 120ms | ✅ 优秀 |
| 动画帧率 | 60fps | ✅ 流畅 |
| 内存占用 | +2MB | ✅ 可接受 |

#### 3.3 兼容性验证

- ✅ Chrome 浏览器
- ✅ Safari 浏览器
- ✅ Android WebView
- ✅ iOS WKWebView

---

### 4. 文件结构更新

```
src/
├── assets/
│   └── lottie/
│       ├── koala_idle.json        ✨ 新增
│       ├── koala_celebrate.json   🔜 待添加
│       └── particles.json         🔜 待添加
├── components/
│   └── LottieAnimation.tsx        ✨ 新增
```

---

## 今日关键洞察

### 1. Figma导出分层是关键
- 图层命名规范直接影响AE工作效率
- 锚点位置决定旋转中心，需要在Figma阶段就设置好
- 建议：身体锚点在底部中心，头部锚点在脖子位置

### 2. AE动画的"呼吸感"
- 所有循环动画都需要"呼吸感"
- 关键：起始帧和结束帧的缓动要一致
- 避免机械感：加入微小的随机抖动

### 3. Lottie文件优化
- 避免使用AE表达式（Bodymovin不支持）
- 复杂路径动画会显著增加文件大小
- 建议：简单变换（位移、旋转、缩放、透明度）为主

---

## 待解决问题

1. **庆祝动画待制作**
   - 考拉张嘴开心 + 跳跃
   - 预计DAY15完成

2. **粒子特效集成**
   - 需要单独的粒子JSON
   - 触发时机：评分≥90分

3. **动画状态切换**
   - idle → celebrate 的过渡
   - 需要实现动画队列管理

---

## 明日计划

### DAY15 目标：MediaPipe姿态追踪集成

1. **MediaPipe Pose配置**
   - 安装 @mediapipe/pose
   - 摄像头权限处理
   - Canvas叠加层设置

2. **骨骼点渲染**
   - 33个关键点绘制
   - 连接线样式配置
   - 实时追踪验证

3. **性能基准测试**
   - 目标：中端设备25fps+
   - 内存占用监控

---

## 今日成果总结

✅ 完成考拉Lottie动画从设计到集成的完整流程
✅ 验证Figma→AE→Lottie→React技术链路
✅ 封装可复用的LottieAnimation组件
✅ 性能测试通过，动画流畅无卡顿

**技术栈确认：** lottie-react + Bodymovin，轻量且兼容性好

---

**项目进度：** █████████░ 45%（设计完成，技术实现启动）

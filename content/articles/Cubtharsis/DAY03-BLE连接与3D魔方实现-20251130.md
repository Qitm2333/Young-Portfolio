# DAY03 - BLEè¿æ¥ä¸3Dé­”æ–¹å®ç°

**æ—¥æœŸ**: 2025-11-30
**çŠ¶æ€**: æ ¸å¿ƒåŠŸèƒ½å®Œæˆ âœ…
**è€—æ—¶**: å…¨å¤©

---

## ğŸ“‹ ä»Šæ—¥å®Œæˆ

### 1. BLEæ¡¥æ¥ç¨‹åºå¼€å‘ â­â­â­â­â­

**ä¸ºä»€ä¹ˆéœ€è¦æ¡¥æ¥ç¨‹åºï¼Ÿ**

Unity Standalone (Win32) ä¸èƒ½ç›´æ¥ä½¿ç”¨ Windows BLE APIï¼ˆ`Windows.Devices.Bluetooth`ï¼‰ï¼Œå› ä¸ºè¿™äº›APIå±äºUWPå¹³å°ã€‚æ‰€ä»¥å¼€å‘äº†ç‹¬ç«‹çš„.NETæ¡¥æ¥ç¨‹åºã€‚

**æ¶æ„è®¾è®¡**:
```
[GANé­”æ–¹] â†BLEâ†’ [GANCubeBridge.exe] â†TCP:9876â†’ [Unityæ¸¸æˆ]
```

**å¼€å‘æµç¨‹**:
1. å…ˆåœ¨ç‹¬ç«‹çª—å£è¿è¡Œæ¡¥æ¥ç¨‹åºè¿›è¡Œè°ƒè¯•
2. å­¦ä¹  `æ’ä»¶/gan-web-bluetooth-main` å¼€æºé¡¹ç›®çš„åè®®å®ç°
3. ç”¨C#/.NETé‡å†™ï¼Œæ”¯æŒGen2/Gen3/Gen4ä¸‰ç§åè®®
4. å®ç°AES-128-CBCåŠ å¯†è§£å¯†ï¼ˆç”¨MACåœ°å€ç”Ÿæˆsaltï¼‰
5. è°ƒè¯•ç¨³å®šåï¼Œé›†æˆåˆ°Unity StreamingAssetsè‡ªåŠ¨å¯åŠ¨

**å…³é”®æ–‡ä»¶**:
- `Unity/CubeProjectUnity/BLEBridge/GANCubeBridge/Program.cs` - æ¡¥æ¥ç¨‹åºæºç ï¼ˆçº¦700è¡Œï¼‰
- `Unity/CubeProjectUnity/BLEBridge/README.md` - ç¼–è¯‘å’Œéƒ¨ç½²è¯´æ˜

**ç¼–è¯‘å‘½ä»¤**:
```bash
cd Unity/CubeProjectUnity/BLEBridge/GANCubeBridge
dotnet publish -c Release -r win-x64 --self-contained
```

### 2. Unityç«¯BLEé€šä¿¡ â­â­â­â­â­

**å…³é”®æ–‡ä»¶**:
- `Unity/CubeProjectUnity/Assets/Scripts/BLE/WindowsBLE.cs` - TCPå®¢æˆ·ç«¯
- `Unity/CubeProjectUnity/Assets/Scripts/BLE/GANCubeProtocol.cs` - æ•°æ®ç»“æ„

**è‡ªåŠ¨å¯åŠ¨æœºåˆ¶**:

å°†ç¼–è¯‘å¥½çš„ `GANCubeBridge.exe` æ”¾åˆ° `Assets/StreamingAssets/BLEBridge/` ç›®å½•åï¼ŒUnityå¯åŠ¨æ—¶ä¼šè‡ªåŠ¨è¿è¡Œæ¡¥æ¥ç¨‹åºã€‚

å…³é”®ä»£ç  (`WindowsBLE.cs`):
```csharp
void Start()
{
    if (autoStartBridge)
        StartBridgeProcess();  // è‡ªåŠ¨å¯åŠ¨æ¡¥æ¥ç¨‹åº
}

void StartBridgeProcess()
{
    string bridgePath = Path.Combine(
        Application.streamingAssetsPath, 
        "BLEBridge", 
        "GANCubeBridge.exe"
    );
    bridgeProcess = new Process();
    bridgeProcess.StartInfo.FileName = bridgePath;
    bridgeProcess.Start();
    
    Invoke(nameof(ConnectToBridge), 1f);  // 1ç§’åè¿æ¥
}

void StopBridgeProcess()
{
    SendCommand("QUIT");  // ä¼˜é›…é€€å‡º
    bridgeProcess.Kill(); // å¼ºåˆ¶å…³é—­
}
```

**é€šä¿¡åè®®**:

Unity â†’ Bridgeï¼ˆå‘½ä»¤ï¼‰:
- `SCAN` - æ‰«æè®¾å¤‡
- `CONNECT:<MAC>` - è¿æ¥è®¾å¤‡
- `DISCONNECT` - æ–­å¼€
- `QUIT` - é€€å‡ºæ¡¥æ¥

Bridge â†’ Unityï¼ˆäº‹ä»¶ï¼‰:
- `DEVICE:<MAC>,<NAME>` - å‘ç°è®¾å¤‡
- `CONNECTED:<NAME>` - è¿æ¥æˆåŠŸ
- `MOVE:<é¢>,<æ–¹å‘>,<åºå·>` - è½¬åŠ¨äº‹ä»¶
- `GYRO:<x>,<y>,<z>,<w>` - é™€èºä»ªå››å…ƒæ•°
- `BATTERY:<ç”µé‡>` - ç”µæ± ç”µé‡

### 3. 3Dé­”æ–¹æ¸²æŸ“ä¸è½¬åŠ¨ç³»ç»Ÿ â­â­â­â­â­

å®ç°äº†å®Œæ•´çš„3Dé­”æ–¹ï¼Œæ”¯æŒè½¬åŠ¨åŠ¨ç”»å’ŒçŠ¶æ€æ£€æµ‹ã€‚

**å…³é”®æ–‡ä»¶**:
- `Unity/CubeProjectUnity/Assets/Scripts/Cube/RubiksCube.cs` - é­”æ–¹æ ¸å¿ƒé€»è¾‘

**æŠ€æœ¯è¦ç‚¹**:
- 26ä¸ªå°æ–¹å—ï¼ˆ3Ã—3Ã—3å»ä¸­å¿ƒï¼‰åŠ¨æ€ç”Ÿæˆ
- åŸºäºå®é™…ä½ç½®é€‰æ‹©è½¬åŠ¨å±‚ï¼ˆéæ•°ç»„ç´¢å¼•ï¼‰
- å¹³æ»‘è½¬åŠ¨åŠ¨ç”»ï¼ˆQuaternion.Slerpï¼‰
- ä½ç½®å’Œæ—‹è½¬å¯¹é½ï¼Œæ¶ˆé™¤æµ®ç‚¹è¯¯å·®ç´¯ç§¯
- è´´çº¸ä½¿ç”¨Unlit/Color shaderç¡®ä¿é¢œè‰²é²œè‰³

### 4. é™€èºä»ªåŒæ­¥ â­â­â­â­

å®ç°é­”æ–¹æ°´å¹³æ—‹è½¬åŒæ­¥ï¼ŒçœŸå®é­”æ–¹è½¬åŠ¨æ—¶å±å¹•é­”æ–¹è·Ÿéšã€‚

**å…³é”®æ–‡ä»¶**:
- `Unity/CubeProjectUnity/Assets/Scripts/Cube/CubeController.cs` - é™€èºä»ªå¤„ç†

**æŠ€æœ¯è¦ç‚¹**:
- GANé­”æ–¹åæ ‡ç³»(Z-up)è½¬Unityåæ ‡ç³»(Y-up)
- åªåŒæ­¥æ°´å¹³æ—‹è½¬ï¼ˆYè½´ï¼‰ï¼Œé¿å…ç©å®¶æ™•çœ©
- å¹³æ»‘æ’å€¼ï¼Œæ¶ˆé™¤æŠ–åŠ¨
- æ”¯æŒé‡ç½®é™€èºä»ªï¼ˆæŒ‰5é”®ï¼‰

### 5. è¾“å…¥æ§åˆ¶ç³»ç»Ÿ â­â­â­â­

æ•´åˆé”®ç›˜ã€é¼ æ ‡ã€BLEè¾“å…¥ã€‚

**å…³é”®æ–‡ä»¶**:
- `Unity/CubeProjectUnity/Assets/Scripts/Cube/CubeController.cs`

**å¿«æ·é”®**:
- U/D/R/L/F/B - è½¬åŠ¨å¯¹åº”é¢
- Shift + ä¸Šè¿° - é€†æ—¶é’ˆ
- Space - æ‰“ä¹±
- Esc - é‡ç½®
- 1 - æ‰«æè®¾å¤‡
- 2 - è¿æ¥é­”æ–¹
- 3 - æ–­å¼€è¿æ¥
- 4 - æŸ¥è¯¢ç”µæ± 
- 5 - é‡ç½®é™€èºä»ª
- 6 - å¼€å…³é™€èºä»ª
- é¼ æ ‡å³é”®æ‹–æ‹½ - æ—‹è½¬è§†è§’
- æ»šè½® - ç¼©æ”¾

---

## ğŸ’¡ å…³é”®è°ƒè¯•ä¸ä¿®å¤

### é—®é¢˜1: é­”æ–¹è½¬åŠ¨æ–¹å‘åäº†
**ç°è±¡**: é¡ºæ—¶é’ˆè½¬åŠ¨æ˜¾ç¤ºä¸ºé€†æ—¶é’ˆ

**ä¿®å¤**: `RubiksCube.cs` ç¬¬233è¡Œ
```csharp
// ä¿®å¤å‰
float targetAngle = clockwise ? -90f : 90f;
// ä¿®å¤å
float targetAngle = clockwise ? 90f : -90f;
```

### é—®é¢˜2: Fé¢å’ŒBé¢è½¬åŠ¨é”™ä½
**ç°è±¡**: è½¬åŠ¨çœŸå®é­”æ–¹Fé¢ï¼Œå±å¹•ä¸ŠBé¢åœ¨è½¬

**åŸå› **: GANé­”æ–¹çš„F/Bå®šä¹‰å’ŒUnityåæ ‡ç³»ç›¸å

**ä¿®å¤**: `CubeController.cs` ç¬¬221-222è¡Œ
```csharp
GANCubeProtocol.CubeFace.F => 'B',  // Få’ŒBäº¤æ¢
GANCubeProtocol.CubeFace.B => 'F',  // Få’ŒBäº¤æ¢
```

### é—®é¢˜3: é™€èºä»ªæ–¹å‘åäº†
**ç°è±¡**: é¡ºæ—¶é’ˆè½¬åŠ¨é­”æ–¹ï¼Œå±å¹•é€†æ—¶é’ˆè½¬

**ä¿®å¤**: `CubeController.cs` ç¬¬268è¡Œ
```csharp
// å–è´Ÿå€¼ä¿®æ­£æ–¹å‘
targetGyroYaw = -(newYaw - gyroYawOffset);
```

### é—®é¢˜4: é™€èºä»ªåæ ‡ç³»è½¬æ¢
**ç°è±¡**: æ°´å¹³è½¬åŠ¨é­”æ–¹æ²¡ååº”ï¼Œå‚ç›´è½¬åŠ¨æ‰æœ‰æ•ˆæœ

**åŸå› **: GANé­”æ–¹æ˜¯Z-upï¼ŒUnityæ˜¯Y-up

**ä¿®å¤**: `CubeController.cs` ç¬¬253è¡Œ
```csharp
// è½¬æ¢åæ ‡ç³»: (x, y, z, w) -> (x, z, y, w)
Quaternion unityRot = new Quaternion(q.x, q.z, q.y, q.w);
```

### é—®é¢˜5: æ¡¥æ¥ç¨‹åºæ®‹ç•™
**ç°è±¡**: Unityåœæ­¢åæ¡¥æ¥ç¨‹åºæ²¡å…³é—­ï¼Œå¯¼è‡´ä¸‹æ¬¡è¿æ¥å¤±è´¥

**ä¿®å¤**: `WindowsBLE.cs` StopBridgeProcessæ–¹æ³•
```csharp
// å…ˆå‘é€QUITå‘½ä»¤
SendCommand("QUIT");
Thread.Sleep(100);
// å†å¼ºåˆ¶Kill
bridgeProcess.Kill();
bridgeProcess.WaitForExit(1000);
```

---

## ğŸ“ é¡¹ç›®ç»“æ„

```
Unity/CubeProjectUnity/
â”œâ”€â”€ Assets/
â”‚   â”œâ”€â”€ Scripts/
â”‚   â”‚   â”œâ”€â”€ BLE/
â”‚   â”‚   â”‚   â”œâ”€â”€ WindowsBLE.cs      # TCPå®¢æˆ·ç«¯ï¼Œä¸æ¡¥æ¥é€šä¿¡
â”‚   â”‚   â”‚   â”œâ”€â”€ GANCubeProtocol.cs # æ•°æ®ç»“æ„å®šä¹‰
â”‚   â”‚   â”‚   â””â”€â”€ README.md
â”‚   â”‚   â””â”€â”€ Cube/
â”‚   â”‚       â”œâ”€â”€ RubiksCube.cs      # é­”æ–¹æ ¸å¿ƒé€»è¾‘
â”‚   â”‚       â”œâ”€â”€ CubeController.cs  # è¾“å…¥æ§åˆ¶ã€é™€èºä»ª
â”‚   â”‚       â”œâ”€â”€ CubeSceneSetup.cs  # åœºæ™¯è‡ªåŠ¨æ­å»º
â”‚   â”‚       â”œâ”€â”€ CubeGameUI.cs      # æ¸¸æˆUIï¼ˆå¾…å®Œå–„ï¼‰
â”‚   â”‚       â””â”€â”€ README.md
â”‚   â””â”€â”€ StreamingAssets/
â”‚       â””â”€â”€ BLEBridge/
â”‚           â””â”€â”€ GANCubeBridge.exe  # æ¡¥æ¥ç¨‹åº
â””â”€â”€ BLEBridge/
    â””â”€â”€ GANCubeBridge/
        â”œâ”€â”€ Program.cs             # æ¡¥æ¥ç¨‹åºæºç 
        â””â”€â”€ GANCubeBridge.csproj
```

---

## ğŸ“Š å½“å‰çŠ¶æ€

### å·²å®Œæˆ âœ…
- GANé­”æ–¹BLEè¿æ¥ï¼ˆGen2åè®®ï¼‰
- è½¬åŠ¨äº‹ä»¶å®æ—¶åŒæ­¥
- é™€èºä»ªæ°´å¹³æ—‹è½¬åŒæ­¥
- 3Dé­”æ–¹æ¸²æŸ“å’Œè½¬åŠ¨åŠ¨ç”»
- é”®ç›˜/é¼ æ ‡æ“ä½œ
- æ¡¥æ¥ç¨‹åºè‡ªåŠ¨å¯åŠ¨/å…³é—­

### å¾…å®Œæˆ â³
- æ¸¸æˆUIå®Œå–„ï¼ˆè®¡æ—¶ã€æ­¥æ•°ï¼‰
- é­”æ–¹çŠ¶æ€æ£€æµ‹ï¼ˆæ˜¯å¦è¿˜åŸï¼‰
- æƒ…ç»ªä¸–ç•Œæœºåˆ¶é›†æˆ
- è¿‡åœºåŠ¨ç”»

---

## ğŸ¯ ä¸‹ä¸€æ­¥è®¡åˆ’

1. **å®Œå–„æ¸¸æˆUI** - è®¡æ—¶å™¨ã€æ­¥æ•°ç»Ÿè®¡ã€è¿˜åŸæ£€æµ‹
2. **é›†æˆæƒ…ç»ªæœºåˆ¶** - å°†é­”æ–¹è½¬åŠ¨ä¸Sadnessä¸–ç•ŒçŠ¶æ€å…³è”
3. **å®ç°çŠ¶æ€è½¬æ¢** - ä¸‰çŠ¶æ€æµåŠ¨é€»è¾‘

---

## ğŸ’¬ ä¸€å¥è¯æ€»ç»“

> "ä»Šå¤©å®Œæˆäº†GANæ™ºèƒ½é­”æ–¹çš„å®Œæ•´BLEè¿æ¥å’Œ3Dé­”æ–¹åŒæ­¥ï¼Œè§£å†³äº†åæ ‡ç³»è½¬æ¢ã€æ–¹å‘æ˜ å°„ç­‰å…³é”®é—®é¢˜ï¼Œä¸ºåç»­æƒ…ç»ªä¸–ç•Œæœºåˆ¶é›†æˆæ‰“ä¸‹åŸºç¡€ã€‚"

---

*ä¸‹ä¸€ä¸ªæ—¥æŠ¥: æ¸¸æˆUIä¸æƒ…ç»ªæœºåˆ¶é›†æˆ*
